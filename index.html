<!DOCTYPE html>
<html>
<head>
    <!--Script for getting plotly.js in-->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> 

    <!--Leaflet stylesheet and leaflet script-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>    

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

</head>

<body>

    <div id="thevizcolumn" style="width:80%; height:800px; float: left; background-color:rgb(255, 255, 255);">
        <p>Cholera</p>
        <div style="width:50%; height:700px; float: left">
        <div id="c_plot" style="width:100%;height:600px;" ></div>
        </div>
        <div style="width:50%; height:700px; float: left">
        <div id="line_plot" style="width:100%;height:600px;" ></div>
        </div>
    </div>


    <script>
   
    Plotly.d3.tsv("./choleraDeaths.tsv", function(err, rows) {

    function unpack(rows, key) {
        return rows.map(function(row) { return row[key]; });
    }

    var headerNames = Plotly.d3.keys(rows[0]);

    var headerValues = [];
    var cellValues = [];
    for (i = 0; i < 4; i++) {
        headerValue = [headerNames[i]];
        headerValues[i] = headerValue;
        cellValue = unpack(rows, headerNames[i]);
        cellValues[i] = cellValue;
    }

    for (j = 0; j < 42; j++) {
        cellValues[3][j] = parseInt(cellValues[1][j]) + parseInt(cellValues[2][j]);
    }

    headerValues[3] ="Total Attacks and Deaths per Day";

    //clean up dates
    for (k = 0; k < 42; k++) {
        if (cellValues[0][k].search('Aug')) {
            cellValues[0][k] = cellValues[0][k].replace("Aug", "8");
        }

        if (cellValues[0][k].search('Sep')) {
            cellValues[0][k] = cellValues[0][k].replace("Sep", "9");
        }
    }

    //switch to year month date format
    for (l = 0; l < 42; l++) {
        var dateValue = cellValues[0][l].split('-');
        var holder = dateValue[0];
        dateValue[0] = dateValue[2];
        dateValue[2] = holder;
        cellValues[0][l] = dateValue.join('-');
    }

    var attacks_cumm = [];
    attacks_cumm[0] = 0;
    //create total attacks cumulatively per day
    for (m = 1; m < 42; m++) {
        attacks_cumm[m] = attacks_cumm[m-1] + parseInt(cellValues[1][m]);
    }
    

    var table = [{
        type: 'table',
        columnorder: [0,1,2,3],
        columnwidth: [300,300,300,300],
        header: {
        values: headerValues,
        align: "center",
        line: {width: 1, color: 'rgb(50, 50, 50)'},
        fill: {color: ['rgb(255, 255, 255)']},
        font: {family: "Arial", size: 8, color: ["black"]}
        },
        cells: {
        values: cellValues,
        align: ["center", "center", "center"],
        line: {color: "black", width: 1},
        fill: {color: ['rgb(102, 219, 240)','rgb(240, 102, 219)', 'rgb(220, 240, 100)', 'rgb(240, 157, 102)']},
        font: {family: "Arial", size: 8, color: ["black"]}
        }
    }]

    var trace1 = {
        x: cellValues[0],
        y: cellValues[1],
        mode: 'lines+markers',
        name: 'Number of Attacks per Day',
        line: {color: '#17BECF'}

    }

    var trace2 = {
        x: cellValues[0],
        y: cellValues[2],
        mode: 'lines+markers',
        name: 'Number of Deaths per Day',
        line: {color: '#7F7F7F'}

    }

    var trace3 = {
        x: cellValues[0],
        y: attacks_cumm,
        mode: 'lines+markers',
        name: 'Total Attacks'

    }

    // var trace4 = [{
    //     mode: 'lines+markers',
    //     name: 'Total Deaths'

    // }


    var c_layout = {
        title: "Cholera Deaths"
    }

    var line_layout = {
        title:'Cholera',
        xaxis: {
        title: 'Time',
        range:  ['19-8-1854', '29-9-1854'],
        type: 'date'
        },
        yaxis: {
            title: '# of People Affected',
            type: 'linear'
        }
    };

    data = [trace1, trace2, trace3];

    Plotly.newPlot('c_plot', table, c_layout);
    Plotly.newPlot('line_plot', data, line_layout);

    });

</script>
</body>
</html>